<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>reproduction code from JSS article ‘tmap: Thematic Maps in R’</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">reproduction code from JSS article ‘tmap: Thematic Maps in R’</h1>


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#section-1.1">Section 1.1</a></li>
<li><a href="#section-3.1">Section 3.1</a></li>
<li><a href="#section-3.2">Section 3.2</a></li>
<li><a href="#section-4.1">Section 4.1</a></li>
<li><a href="#section-4.2">Section 4.2</a></li>
<li><a href="#section-4.3">Section 4.3</a></li>
<li><a href="#section-4.4">Section 4.4</a></li>
<li><a href="#section-4.5">Section 4.5</a></li>
</ul>
</div>

<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>The article <em>Tennekes, M. tmap: Thematic Maps in R (2018), Journal of Statistical Software 84(6), 1-39,</em> <a href="http://dx.doi.org/10.18637/jss.v084.i06" class="uri">http://dx.doi.org/10.18637/jss.v084.i06</a> describes version 1.x of tmap and tmaptools. Since tmap and tmaptools version 2.0 are based on <code>sf</code> objects instead of <code>sp</code> objects, there are some changes in the code, especially regarding the necessary processing step. The code for the plotting methods is fully backward compatible, although some messages or warnings may be given for deprecated functions or arguments.</p>
<p>This code replaces the script v84i06.R for tmap and tmaptools version 2.0. The produced figures are identical to those included in the article.</p>
<p>See <a href="../doc/tmap-changes.html"><code>vignette(&quot;tmap-changes&quot;)</code></a> for changes in version 2.x/3.x, which is recommended for people who have read the JSS article. For people who are new to tmap, see <a href="../doc/tmap-getstarted.html"><code>vignette(&quot;tmap-getstarted&quot;)</code></a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">###########################################################################</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">## This script will replicate the figures (except the screenshots)</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">## and write them to files.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">## The working directory should be set the the parent folder of this script.</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">###########################################################################</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">## install.packages(c(&quot;tmap&quot;, &quot;tmaptools&quot;))</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">library</span>(<span class="st">&quot;tmap&quot;</span>) <span class="co"># required version 2.0 or later</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">library</span>(<span class="st">&quot;tmaptools&quot;</span>) <span class="co"># required version 2.0 or later</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">data</span>(<span class="st">&quot;World&quot;</span>, <span class="st">&quot;metro&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tmap&quot;</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">metro<span class="op">$</span>growth &lt;-<span class="st"> </span>(metro<span class="op">$</span>pop2020 <span class="op">-</span><span class="st"> </span>metro<span class="op">$</span>pop2010) <span class="op">/</span><span class="st"> </span>(metro<span class="op">$</span>pop2010 <span class="op">*</span><span class="st"> </span><span class="dv">10</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a></code></pre></div>
</div>
<div id="section-1.1" class="section level3">
<h3>Section 1.1</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">## Figure 1</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">m1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(World) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">    </span><span class="kw">tm_polygons</span>(<span class="st">&quot;income_grp&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;-Blues&quot;</span>, </a>
<a class="sourceLine" id="cb2-7" data-line-number="7">      <span class="dt">title =</span> <span class="st">&quot;Income class&quot;</span>, <span class="dt">contrast =</span> <span class="fl">0.7</span>, <span class="dt">border.col =</span> <span class="st">&quot;grey30&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;name&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">    </span><span class="kw">tm_text</span>(<span class="st">&quot;iso_a3&quot;</span>, <span class="dt">size =</span> <span class="st">&quot;AREA&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;grey30&quot;</span>, <span class="dt">root =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">  </span><span class="kw">tm_shape</span>(metro) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="st">    </span><span class="kw">tm_bubbles</span>(<span class="st">&quot;pop2010&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;growth&quot;</span>, <span class="dt">border.col =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">      <span class="dt">border.alpha =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">      <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="ot">Inf</span>) ,</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">      <span class="dt">palette =</span> <span class="st">&quot;-RdYlGn&quot;</span>,</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">      <span class="dt">title.size =</span> <span class="st">&quot;Metro population (2010)&quot;</span>, </a>
<a class="sourceLine" id="cb2-15" data-line-number="15">      <span class="dt">title.col =</span> <span class="st">&quot;Annual growth rate (%)&quot;</span>,</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">      <span class="dt">id =</span> <span class="st">&quot;name&quot;</span>,</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">      <span class="dt">popup.vars =</span> <span class="kw">c</span>(<span class="st">&quot;pop2010&quot;</span>, <span class="st">&quot;pop2020&quot;</span>, <span class="st">&quot;growth&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="st">  </span><span class="kw">tm_style</span>(<span class="st">&quot;gray&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="st">  </span><span class="kw">tm_format</span>(<span class="st">&quot;World&quot;</span>, <span class="dt">frame.lwd =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="kw">tmap_save</span>(m1, <span class="st">&quot;bubble.png&quot;</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">height =</span> <span class="dv">3</span>, <span class="dt">scale =</span> <span class="fl">.75</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">asp =</span> <span class="dv">0</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
</div>
<div id="section-3.1" class="section level3">
<h3>Section 3.1</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">## Figure 2</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">m0 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(metro) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">  </span><span class="kw">tm_bubbles</span>(<span class="dt">size =</span> <span class="st">&quot;pop2030&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">  </span><span class="kw">tm_style</span>(<span class="st">&quot;cobalt&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">  </span><span class="kw">tm_format</span>(<span class="st">&quot;World&quot;</span>)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">tmap_save</span>(m0, <span class="st">&quot;metro2030.png&quot;</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">scale =</span> <span class="fl">.5</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
</div>
<div id="section-3.2" class="section level3">
<h3>Section 3.2</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">## Figure 3</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">m21 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(World) <span class="op">+</span><span class="st"> </span><span class="kw">tm_polygons</span>(<span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">tm_layout</span>(<span class="dt">frame.lwd =</span> <span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">tmap_save</span>(m21, <span class="st">&quot;facets1.png&quot;</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">height =</span> <span class="fl">1.54</span>, <span class="dt">scale =</span> <span class="fl">.75</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">## Figure 4</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">m22 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(World) <span class="op">+</span><span class="st"> </span><span class="kw">tm_polygons</span>(<span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">tm_facets</span>(<span class="dt">by =</span> <span class="st">&quot;continent&quot;</span>, <span class="dt">free.coords =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">tmap_save</span>(m22, <span class="st">&quot;facets2.png&quot;</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">height =</span> <span class="fl">1.8</span>, <span class="dt">scale =</span> <span class="fl">.75</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">## Figure 5</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">tm1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(World) <span class="op">+</span><span class="st"> </span><span class="kw">tm_polygons</span>()</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">tm2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(metro) <span class="op">+</span><span class="st"> </span><span class="kw">tm_dots</span>()</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw">png</span>(<span class="st">&quot;facets3.png&quot;</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">height =</span> <span class="fl">1.54</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">res =</span> <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="kw">tmap_arrange</span>(tm1, tm2, <span class="dt">outer.margins =</span> <span class="fl">.01</span>)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="kw">dev.off</span>()</a></code></pre></div>
</div>
<div id="section-4.1" class="section level3">
<h3>Section 4.1</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">## Figure 6</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">m1</a></code></pre></div>
</div>
<div id="section-4.2" class="section level3">
<h3>Section 4.2</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">## Figure 7</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">data</span>(<span class="st">&quot;land&quot;</span>, <span class="st">&quot;rivers&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tmap&quot;</span>)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">m2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(land) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">  </span><span class="kw">tm_raster</span>(<span class="st">&quot;elevation&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">1500</span>, <span class="dv">2000</span>, <span class="dv">2500</span>, <span class="dv">3000</span>, <span class="dv">4000</span>, <span class="ot">Inf</span>),  </a>
<a class="sourceLine" id="cb8-7" data-line-number="7">            <span class="dt">palette =</span> <span class="kw">terrain.colors</span>(<span class="dv">9</span>), <span class="dt">title =</span> <span class="st">&quot;Elevation (m)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">  </span><span class="kw">tm_shape</span>(rivers) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="st">  </span><span class="kw">tm_lines</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="dt">lwd =</span> <span class="st">&quot;strokelwd&quot;</span>, <span class="dt">scale =</span> <span class="fl">1.5</span>, <span class="dt">legend.lwd.show =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="st">  </span><span class="kw">tm_shape</span>(World, <span class="dt">is.master =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">  </span><span class="kw">tm_borders</span>(<span class="st">&quot;grey20&quot;</span>, <span class="dt">lwd =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="st">  </span><span class="kw">tm_grid</span>(<span class="dt">projection =</span> <span class="st">&quot;longlat&quot;</span>, <span class="dt">labels.size =</span> <span class="fl">0.4</span>, <span class="dt">lwd =</span> <span class="fl">0.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="st">  </span><span class="kw">tm_text</span>(<span class="st">&quot;name&quot;</span>, <span class="dt">size =</span> <span class="st">&quot;AREA&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="st">  </span><span class="kw">tm_compass</span>(<span class="dt">position =</span> <span class="kw">c</span>(<span class="fl">0.08</span>, <span class="fl">0.45</span>), <span class="dt">color.light =</span> <span class="st">&quot;grey90&quot;</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="st">  </span><span class="kw">tm_credits</span>(<span class="st">&quot;Eckert IV projection&quot;</span>, <span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;RIGHT&quot;</span>, <span class="st">&quot;BOTTOM&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="st">  </span><span class="kw">tm_style</span>(<span class="st">&quot;classic&quot;</span>,</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">         <span class="dt">bg.color =</span> <span class="st">&quot;lightblue&quot;</span>,</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">         <span class="dt">space.color =</span> <span class="st">&quot;grey90&quot;</span>,</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">         <span class="dt">inner.margins =</span> <span class="kw">c</span>(<span class="fl">0.04</span>, <span class="fl">0.04</span>, <span class="fl">0.03</span>, <span class="fl">0.02</span>), </a>
<a class="sourceLine" id="cb8-20" data-line-number="20">         <span class="dt">earth.boundary =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), </a>
<a class="sourceLine" id="cb8-22" data-line-number="22">            <span class="dt">frame =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb8-23" data-line-number="23">            <span class="dt">bg.color =</span> <span class="st">&quot;lightblue&quot;</span>)</a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="kw">tmap_save</span>(m2, <span class="st">&quot;classic.png&quot;</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">scale =</span> <span class="fl">.7</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
</div>
<div id="section-4.3" class="section level3">
<h3>Section 4.3</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">## Figure 8</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">m3 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(World, <span class="dt">projection =</span> <span class="st">&quot;robin&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="kw">c</span>(<span class="st">&quot;HPI&quot;</span>, <span class="st">&quot;gdp_cap_est&quot;</span>),</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">              <span class="dt">palette =</span> <span class="kw">list</span>(<span class="st">&quot;RdYlGn&quot;</span>, <span class="st">&quot;Purples&quot;</span>),</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">              <span class="dt">style =</span> <span class="kw">c</span>(<span class="st">&quot;pretty&quot;</span>, <span class="st">&quot;fixed&quot;</span>), <span class="dt">n =</span> <span class="dv">7</span>, </a>
<a class="sourceLine" id="cb9-8" data-line-number="8">              <span class="dt">breaks =</span> <span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">2000</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">25000</span>, <span class="dv">50000</span>, <span class="ot">Inf</span>)),</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">              <span class="dt">title =</span> <span class="kw">c</span>(<span class="st">&quot;Happy Planet Index&quot;</span>, <span class="st">&quot;GDP per capita&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="st">  </span><span class="kw">tm_style</span>(<span class="st">&quot;natural&quot;</span>, <span class="dt">earth.boundary =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>, <span class="dv">-87</span>, <span class="dv">180</span>, <span class="dv">87</span>))  <span class="op">+</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="st">  </span><span class="kw">tm_format</span>(<span class="st">&quot;World&quot;</span>, <span class="dt">inner.margins =</span> <span class="fl">0.02</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="dt">bg.color =</span> <span class="st">&quot;gray95&quot;</span>, <span class="dt">frame =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="st">  </span><span class="kw">tm_credits</span>(<span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;Robinson projection&quot;</span>), <span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;RIGHT&quot;</span>, <span class="st">&quot;BOTTOM&quot;</span>))</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="kw">tmap_save</span>(m3, <span class="st">&quot;world_facets2.png&quot;</span>, <span class="dt">width =</span> <span class="dv">5</span>, <span class="dt">scale =</span> <span class="fl">.7</span>, <span class="dt">dpi =</span> <span class="dv">300</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
</div>
<div id="section-4.4" class="section level3">
<h3>Section 4.4</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">## Figure 9</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;readxl&quot;</span>)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;grid&quot;</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co"># function to obtain Food Environment Atlas data (2014)</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">get_food_envir_data &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">  dir &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(<span class="kw">file.path</span>(dir, <span class="st">&quot;DataDownload.xls&quot;</span>))) {</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">    <span class="kw">download.file</span>(<span class="st">&quot;https://www.ers.usda.gov/webdocs/DataFiles/48731/February2014.xls?v=41688&quot;</span>, <span class="dt">destfile =</span> <span class="kw">file.path</span>(dir, <span class="st">&quot;DataDownload.xls&quot;</span>), <span class="dt">mode =</span> <span class="st">&quot;wb&quot;</span>)</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">  res &lt;-<span class="st"> </span><span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">    <span class="kw">read_excel</span>(<span class="kw">file.path</span>(dir, <span class="st">&quot;DataDownload.xls&quot;</span>), <span class="dt">sheet =</span> <span class="st">&quot;HEALTH&quot;</span>)    </a>
<a class="sourceLine" id="cb10-15" data-line-number="15">  }, <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">    <span class="kw">stop</span>(<span class="st">&quot;The excel file cannot be read. Please open it, and remove all sheets except HEALTH. The location of the file is: &quot;</span>, <span class="kw">normalizePath</span>(<span class="kw">file.path</span>(dir, <span class="st">&quot;DataDownload.xls&quot;</span>)))</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">  })</a>
<a class="sourceLine" id="cb10-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb10-19" data-line-number="19"></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co"># function to obtain US county shape</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21">get_US_county_<span class="dv">2010</span>_shape &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">  dir &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb10-23" data-line-number="23">  <span class="kw">download.file</span>(<span class="st">&quot;http://www2.census.gov/geo/tiger/GENZ2010/gz_2010_us_050_00_20m.zip&quot;</span>, <span class="dt">destfile =</span> <span class="kw">file.path</span>(dir, <span class="st">&quot;gz_2010_us_050_00_20m.zip&quot;</span>))</a>
<a class="sourceLine" id="cb10-24" data-line-number="24">  <span class="kw">unzip</span>(<span class="kw">file.path</span>(dir, <span class="st">&quot;gz_2010_us_050_00_20m.zip&quot;</span>), <span class="dt">exdir =</span> dir)</a>
<a class="sourceLine" id="cb10-25" data-line-number="25">  US &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">read_sf</span>(<span class="kw">file.path</span>(dir, <span class="st">&quot;gz_2010_us_050_00_20m.shp&quot;</span>))</a>
<a class="sourceLine" id="cb10-26" data-line-number="26">  <span class="kw">levels</span>(US<span class="op">$</span>NAME) &lt;-<span class="st"> </span><span class="kw">iconv</span>(<span class="kw">levels</span>(US<span class="op">$</span>NAME), <span class="dt">from =</span> <span class="st">&quot;latin1&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;utf8&quot;</span>)</a>
<a class="sourceLine" id="cb10-27" data-line-number="27">  US</a>
<a class="sourceLine" id="cb10-28" data-line-number="28">}</a>
<a class="sourceLine" id="cb10-29" data-line-number="29"></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co"># obtain Food Environment Atlas data</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31">FEA &lt;-<span class="st"> </span><span class="kw">get_food_envir_data</span>()</a>
<a class="sourceLine" id="cb10-32" data-line-number="32"></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="co"># obtain US county shape</span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34">US &lt;-<span class="st"> </span><span class="kw">get_US_county_2010_shape</span>()</a>
<a class="sourceLine" id="cb10-35" data-line-number="35"></a>
<a class="sourceLine" id="cb10-36" data-line-number="36">us1 &lt;-<span class="st"> </span><span class="kw">qtm</span>(US)</a>
<a class="sourceLine" id="cb10-37" data-line-number="37"></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="kw">tmap_save</span>(us1, <span class="st">&quot;US1.png&quot;</span>, <span class="dt">scale =</span> <span class="fl">.5</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">asp =</span> <span class="dv">0</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb10-39" data-line-number="39"></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb10-41" data-line-number="41"><span class="co">## Figure 10</span></a>
<a class="sourceLine" id="cb10-42" data-line-number="42"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb10-45" data-line-number="45"></a>
<a class="sourceLine" id="cb10-46" data-line-number="46">US<span class="op">$</span>FIPS &lt;-<span class="st"> </span><span class="kw">paste0</span>(US<span class="op">$</span>STATE, US<span class="op">$</span>COUNTY)</a>
<a class="sourceLine" id="cb10-47" data-line-number="47"></a>
<a class="sourceLine" id="cb10-48" data-line-number="48"><span class="co"># append data to shape</span></a>
<a class="sourceLine" id="cb10-49" data-line-number="49"><span class="co">#US &lt;- append_data(US, FEA, key.shp = &quot;FIPS&quot;, key.data = &quot;FIPS&quot;, ignore.duplicates = TRUE)</span></a>
<a class="sourceLine" id="cb10-50" data-line-number="50">US &lt;-<span class="st"> </span><span class="kw">left_join</span>(US, FEA, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;FIPS&quot;</span>, <span class="st">&quot;FIPS&quot;</span>))</a>
<a class="sourceLine" id="cb10-51" data-line-number="51"></a>
<a class="sourceLine" id="cb10-52" data-line-number="52"></a>
<a class="sourceLine" id="cb10-53" data-line-number="53">unmatched_data &lt;-<span class="st"> </span>FEA <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>(FIPS <span class="op">%in%</span><span class="st"> </span>US<span class="op">$</span>FIPS))</a>
<a class="sourceLine" id="cb10-54" data-line-number="54"></a>
<a class="sourceLine" id="cb10-55" data-line-number="55"><span class="kw">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</a>
<a class="sourceLine" id="cb10-56" data-line-number="56"><span class="kw">qtm</span>(US, <span class="dt">fill =</span> <span class="st">&quot;PCT_OBESE_ADULTS10&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">## Figure 11</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">US_cont &lt;-<span class="st"> </span>US <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw">subset</span>(<span class="op">!</span>STATE <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;72&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span><span class="kw">simplify_shape</span>(<span class="fl">0.2</span>) </a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">US_AK &lt;-<span class="st"> </span>US <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw">subset</span>(STATE <span class="op">==</span><span class="st"> &quot;02&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="kw">simplify_shape</span>(<span class="fl">0.2</span>) </a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">US_HI &lt;-<span class="st"> </span>US <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="st">  </span><span class="kw">subset</span>(STATE <span class="op">==</span><span class="st"> &quot;15&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="st">  </span><span class="kw">simplify_shape</span>(<span class="fl">0.2</span>) </a>
<a class="sourceLine" id="cb11-15" data-line-number="15"></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co"># create state boundaries</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">US_states &lt;-<span class="st"> </span>US_cont <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(geometry) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="st">    </span><span class="kw">aggregate</span>(<span class="dt">by =</span> <span class="kw">list</span>(US_cont<span class="op">$</span>STATE), <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb11-20" data-line-number="20"></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co"># contiguous US</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23">m_cont &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(US_cont, <span class="dt">projection =</span> <span class="dv">2163</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;PCT_OBESE_ADULTS10&quot;</span>, <span class="dt">border.col =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">border.alpha =</span> <span class="fl">.5</span>, <span class="dt">title =</span> <span class="st">&quot;&quot;</span>, <span class="dt">showNA =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="st">  </span><span class="kw">tm_shape</span>(US_states) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="st">  </span><span class="kw">tm_credits</span>(<span class="st">&quot;Data @ Unites States Department of Agriculture</span><span class="ch">\n</span><span class="st">Shape @ Unites States Census Bureau&quot;</span>, <span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">title =</span> <span class="st">&quot;2010 Adult Obesity by County, percent&quot;</span>, </a>
<a class="sourceLine" id="cb11-29" data-line-number="29">            <span class="dt">title.position =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;top&quot;</span>), </a>
<a class="sourceLine" id="cb11-30" data-line-number="30">            <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), </a>
<a class="sourceLine" id="cb11-31" data-line-number="31">            <span class="dt">frame =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb11-32" data-line-number="32">            <span class="dt">inner.margins =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>))</a>
<a class="sourceLine" id="cb11-33" data-line-number="33"></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co"># Alaska inset</span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35">m_AK &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(US_AK, <span class="dt">projection =</span> <span class="dv">3338</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;PCT_OBESE_ADULTS10&quot;</span>, <span class="dt">border.col =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">border.alpha =</span> <span class="fl">.5</span>, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="st">  </span><span class="kw">tm_layout</span>(<span class="st">&quot;Alaska&quot;</span>, <span class="dt">legend.show =</span> <span class="ot">FALSE</span>, <span class="dt">bg.color =</span> <span class="ot">NA</span>, <span class="dt">title.size =</span> <span class="fl">0.8</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-38" data-line-number="38"></a>
<a class="sourceLine" id="cb11-39" data-line-number="39"><span class="co"># Hawaii inset</span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40">m_HI &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(US_HI, <span class="dt">projection =</span> <span class="dv">3759</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-41" data-line-number="41"><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="st">&quot;PCT_OBESE_ADULTS10&quot;</span>, <span class="dt">border.col =</span> <span class="st">&quot;gray50&quot;</span>, <span class="dt">border.alpha =</span> <span class="fl">.5</span>, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-42" data-line-number="42"><span class="st">  </span><span class="kw">tm_layout</span>(<span class="st">&quot;Hawaii&quot;</span>, <span class="dt">legend.show =</span> <span class="ot">FALSE</span>, <span class="dt">bg.color =</span> <span class="ot">NA</span>, <span class="dt">title.position =</span> <span class="kw">c</span>(<span class="st">&quot;LEFT&quot;</span>, <span class="st">&quot;BOTTOM&quot;</span>), <span class="dt">title.size =</span> <span class="fl">0.8</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-43" data-line-number="43"></a>
<a class="sourceLine" id="cb11-44" data-line-number="44"><span class="co"># specify viewports for Alaska and Hawaii</span></a>
<a class="sourceLine" id="cb11-45" data-line-number="45">vp_AK &lt;-<span class="st"> </span><span class="kw">viewport</span>(<span class="dt">x =</span> <span class="fl">0.15</span>, <span class="dt">y =</span> <span class="fl">0.15</span>, <span class="dt">width =</span> <span class="fl">0.3</span>, <span class="dt">height =</span> <span class="fl">0.3</span>)</a>
<a class="sourceLine" id="cb11-46" data-line-number="46">vp_HI &lt;-<span class="st"> </span><span class="kw">viewport</span>(<span class="dt">x =</span> <span class="fl">0.4</span>, <span class="dt">y =</span> <span class="fl">0.1</span>, <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">height =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb11-47" data-line-number="47"></a>
<a class="sourceLine" id="cb11-48" data-line-number="48"><span class="co"># save map</span></a>
<a class="sourceLine" id="cb11-49" data-line-number="49"><span class="kw">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</a>
<a class="sourceLine" id="cb11-50" data-line-number="50"><span class="kw">tmap_save</span>(m_cont, <span class="st">&quot;USchoro.png&quot;</span>, <span class="dt">scale =</span> <span class="fl">0.7</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb11-51" data-line-number="51">          <span class="dt">insets_tm =</span> <span class="kw">list</span>(m_AK, m_HI), </a>
<a class="sourceLine" id="cb11-52" data-line-number="52">          <span class="dt">insets_vp =</span> <span class="kw">list</span>(vp_AK, vp_HI))</a></code></pre></div>
</div>
<div id="section-4.5" class="section level3">
<h3>Section 4.5</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">## Figure 12a</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;sf&quot;</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;rnaturalearth&quot;</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co"># functions to obtain crimes data</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">get_crimes_data &lt;-<span class="st"> </span><span class="cf">function</span>(path) {</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="kw">stopifnot</span>(<span class="kw">file.exists</span>(path), (<span class="st">&quot;crimes_in_Greater_London_2015-10.zip&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">list.files</span>(path)))</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  tmp_dir &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="kw">unzip</span>(<span class="kw">file.path</span>(path, <span class="st">&quot;crimes_in_Greater_London_2015-10.zip&quot;</span>), <span class="dt">exdir =</span> tmp_dir)</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">  <span class="kw">rbind</span>(<span class="kw">read.csv</span>(<span class="kw">file.path</span>(tmp_dir, <span class="st">&quot;2015-10-city-of-london-street.csv&quot;</span>)),</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">        <span class="kw">read.csv</span>(<span class="kw">file.path</span>(tmp_dir, <span class="st">&quot;2015-10-metropolitan-street.csv&quot;</span>)))</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb12-15" data-line-number="15"></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co"># please download the file &quot;crimes_in_Greater_London_2015-10.zip&quot; (available on https://www.jstatsoft.org as a supplement of this paper), and change the path argument below to the location of the downloaded file:</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17">crimes &lt;-<span class="st"> </span><span class="kw">get_crimes_data</span>(<span class="dt">path =</span> <span class="st">&quot;./&quot;</span>)</a>
<a class="sourceLine" id="cb12-18" data-line-number="18"></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co"># create sf of known locations</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20">crimes &lt;-<span class="st"> </span>crimes[<span class="op">!</span><span class="kw">is.na</span>(crimes<span class="op">$</span>Longitude) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(crimes<span class="op">$</span>Latitude), ]</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">crimes &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(crimes, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</a>
<a class="sourceLine" id="cb12-22" data-line-number="22"></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co"># set map projection to British National Grid</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24">crimes &lt;-<span class="st"> </span><span class="kw">st_transform</span>(crimes, <span class="dt">crs =</span> <span class="dv">27700</span>)</a>
<a class="sourceLine" id="cb12-25" data-line-number="25"></a>
<a class="sourceLine" id="cb12-26" data-line-number="26">c1 &lt;-<span class="st"> </span><span class="kw">qtm</span>(crimes)</a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="kw">tmap_save</span>(c1, <span class="st">&quot;crimes1.png&quot;</span>, <span class="dt">scale =</span> <span class="fl">.6</span>, <span class="dt">width =</span> <span class="dv">3</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">## Figure 12b</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">crimes_osm &lt;-<span class="st"> </span><span class="kw">read_osm</span>(crimes)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">c2 &lt;-<span class="st"> </span><span class="kw">qtm</span>(crimes_osm) <span class="op">+</span><span class="st"> </span><span class="kw">qtm</span>(crimes, <span class="dt">symbols.col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">symbols.size =</span> <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">tmap_save</span>(c2, <span class="st">&quot;crimes2.jpg&quot;</span>, <span class="dt">scale =</span> <span class="fl">.6</span>, <span class="dt">width =</span> <span class="dv">3</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co">## Figure 13</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">c3 &lt;-<span class="st"> </span><span class="kw">qtm</span>(crimes_osm, <span class="dt">raster.saturation =</span> <span class="dv">0</span>, <span class="dt">raster.alpha =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="st">  </span><span class="kw">qtm</span>(crimes, <span class="dt">symbols.col =</span> <span class="st">&quot;Crime.type&quot;</span>, <span class="dt">symbols.size =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">outside =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="kw">tmap_save</span>(c3, <span class="st">&quot;crimes3.png&quot;</span>, <span class="dt">scale =</span> <span class="fl">.8</span>, <span class="dt">width =</span> <span class="dv">5</span>, <span class="dt">height =</span> <span class="dv">4</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">## Figure 14</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">regions &lt;-<span class="st"> </span><span class="kw">ne_download</span>(<span class="dt">scale =</span> <span class="st">&quot;large&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;states&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;cultural&quot;</span>, <span class="dt">returnclass =</span> <span class="st">&quot;sf&quot;</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">london &lt;-<span class="st"> </span>regions[<span class="kw">which</span>(regions<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;Greater London&quot;</span>),]</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">london &lt;-<span class="st"> </span><span class="kw">st_transform</span>(london, <span class="dt">crs =</span> <span class="dv">27700</span>)</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co"># remove crimes outside Greater London</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9">crimes_london &lt;-<span class="st"> </span><span class="kw">crop_shape</span>(crimes, london, <span class="dt">polygon =</span>  <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">c3b &lt;-<span class="st"> </span><span class="kw">qtm</span>(crimes_london, <span class="dt">dots.alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="st">  </span><span class="kw">tm_shape</span>(london) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="st">  </span><span class="kw">tm_borders</span>()</a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="kw">tmap_save</span>(c3b, <span class="st">&quot;crimes3b.png&quot;</span>, <span class="dt">scale =</span> <span class="fl">.7</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">## Figure 15</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;devtools&quot;</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw">install_github</span>(<span class="st">&quot;mtennekes/oldtmaptools&quot;</span>)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="kw">library</span>(oldtmaptools)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"></a>
<a class="sourceLine" id="cb16-8" data-line-number="8">crime_densities &lt;-<span class="st"> </span><span class="kw">smooth_map</span>(crimes_london, <span class="dt">bandwidth =</span> <span class="fl">0.5</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>), <span class="dt">cover =</span> london)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co"># download rivers, and get Thames shape</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">rivers &lt;-<span class="st"> </span><span class="kw">ne_download</span>(<span class="dt">scale =</span> <span class="st">&quot;large&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;rivers_lake_centerlines&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;physical&quot;</span>)</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">thames &lt;-<span class="st"> </span><span class="kw">crop_shape</span>(rivers, london)</a>
<a class="sourceLine" id="cb16-13" data-line-number="13"></a>
<a class="sourceLine" id="cb16-14" data-line-number="14">c4 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(crime_densities<span class="op">$</span>polygons) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;level&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, <span class="dt">title =</span> <span class="kw">expression</span>(<span class="st">&quot;Crimes per &quot;</span> <span class="op">*</span><span class="st"> </span>km<span class="op">^</span><span class="dv">2</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="st">  </span><span class="kw">tm_shape</span>(london) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="st">  </span><span class="kw">tm_shape</span>(thames) <span class="op">+</span><span class="st"> </span><span class="kw">tm_lines</span>(<span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="st">  </span><span class="kw">tm_compass</span>(<span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="st">  </span><span class="kw">tm_scale_bar</span>(<span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="st">  </span><span class="kw">tm_style</span>(<span class="st">&quot;gray&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Crimes in Greater London</span><span class="ch">\n</span><span class="st">October 2015&quot;</span>)</a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="kw">tmap_save</span>(c4, <span class="st">&quot;crimes4.png&quot;</span>, <span class="dt">scale =</span> <span class="fl">.7</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">## Figure 16</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">london_city &lt;-<span class="st"> </span>london[london<span class="op">$</span>name <span class="op">==</span><span class="st"> &quot;City&quot;</span>,]</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">crimes_city &lt;-<span class="st"> </span><span class="kw">crop_shape</span>(crimes_london, london_city, <span class="dt">polygon =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">london_osm &lt;-<span class="st"> </span><span class="kw">read_osm</span>(london_city, <span class="dt">type =</span> <span class="st">&quot;stamen-watercolor&quot;</span>, <span class="dt">zoom =</span> <span class="dv">13</span>)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">c5 &lt;-<span class="st"> </span><span class="kw">qtm</span>(london_osm) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="st">  </span><span class="kw">tm_shape</span>(crimes_city) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="st">  </span><span class="kw">tm_facets</span>(<span class="st">&quot;Crime.type&quot;</span>, <span class="dt">free.coords =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="kw">tmap_save</span>(c5, <span class="st">&quot;crimes5.png&quot;</span>, <span class="dt">scale =</span> <span class="dv">1</span>, <span class="dt">width =</span> <span class="fl">6.125</span>, <span class="dt">asp =</span> <span class="ot">NA</span>, <span class="dt">outer.margins =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">## Figure 17</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#############################</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">crime_lookup &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Anti-social behaviour&quot;</span> =<span class="st"> </span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                  <span class="st">&quot;Bicycle theft&quot;</span> =<span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb18-6" data-line-number="6">                  <span class="st">&quot;Burglary&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">                  <span class="st">&quot;Criminal damage and arson&quot;</span> =<span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">                  <span class="st">&quot;Drugs&quot;</span> =<span class="st"> </span><span class="dv">6</span>, </a>
<a class="sourceLine" id="cb18-9" data-line-number="9">                  <span class="st">&quot;Other crime&quot;</span> =<span class="st"> </span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">                  <span class="st">&quot;Other theft&quot;</span> =<span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb18-11" data-line-number="11">                  <span class="st">&quot;Possession of weapons&quot;</span> =<span class="st"> </span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb18-12" data-line-number="12">                  <span class="st">&quot;Public order&quot;</span> =<span class="st"> </span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb18-13" data-line-number="13">                  <span class="st">&quot;Robbery&quot;</span> =<span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb18-14" data-line-number="14">                  <span class="st">&quot;Shoplifting&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb18-15" data-line-number="15">                  <span class="st">&quot;Theft from the person&quot;</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb18-16" data-line-number="16">                  <span class="st">&quot;Vehicle crime&quot;</span> =<span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb18-17" data-line-number="17">                  <span class="st">&quot;Violence and sexual offences&quot;</span> =<span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb18-18" data-line-number="18">crime_categories &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Property Crime&quot;</span>,</a>
<a class="sourceLine" id="cb18-19" data-line-number="19">                      <span class="st">&quot;Criminal damage and anti-social behaviour&quot;</span>,</a>
<a class="sourceLine" id="cb18-20" data-line-number="20">                      <span class="st">&quot;Possession of weapons&quot;</span>,</a>
<a class="sourceLine" id="cb18-21" data-line-number="21">                      <span class="st">&quot;Vehicle crime&quot;</span>,</a>
<a class="sourceLine" id="cb18-22" data-line-number="22">                      <span class="st">&quot;Violence and sexual offences&quot;</span>,</a>
<a class="sourceLine" id="cb18-23" data-line-number="23">                      <span class="st">&quot;Drugs&quot;</span>,</a>
<a class="sourceLine" id="cb18-24" data-line-number="24">                      <span class="st">&quot;Other crime&quot;</span>)</a>
<a class="sourceLine" id="cb18-25" data-line-number="25">crimes_city<span class="op">$</span>Crime.group &lt;-<span class="st"> </span><span class="kw">factor</span>(crime_lookup[crimes_city<span class="op">$</span>Crime.type], <span class="dt">labels =</span> crime_categories)</a>
<a class="sourceLine" id="cb18-26" data-line-number="26"></a>
<a class="sourceLine" id="cb18-27" data-line-number="27"><span class="kw">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="kw">tm_shape</span>(crimes_city) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29"><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">jitter =</span> <span class="fl">0.2</span>, <span class="dt">col =</span> <span class="st">&quot;Crime.group&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>, <span class="dt">popup.vars =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-30" data-line-number="30"><span class="st">  </span><span class="kw">tm_view</span>(<span class="dt">alpha =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb18-31" data-line-number="31">    <span class="dt">basemaps =</span> <span class="st">&quot;Esri.WorldTopoMap&quot;</span>)</a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
